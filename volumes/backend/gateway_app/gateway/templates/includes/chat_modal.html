{% load static %}
{% load i18n %}

<!-- Chat -->
<div id="chatButton" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050">
	<img src="{% static 'images/chat_icon.png' %}" alt="Chat" data-bs-toggle="modal" data-bs-target="#chatModal" style="width: 100px; height: 100px; cursor: pointer;">
	<span id="unreadChatscount" class="badge rounded-pill bg-danger position-absolute translate-middle" style="top: 30px; left: 90px; font-size: 1rem; padding: 0.5rem 0.7rem;">0</span>
</div>

<section>
		<!-- Modal -->
		<div class="modal fade" id="chatModal" tabindex="-2" aria-labelledby="chatModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg" style="height: 90vh;" role="document">
				<div class="modal-content" style="background: linear-gradient(to left, #747474, #333333);">
					<div class="modal-header d-flex justify-content-center align-items-center">
						<h5 style="color: white; flex-grow: 1; text-align: center;" class="modal-title" id="chatModalLabel">{% trans "Chat messages" %}</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>

					<!-- Main content: Contacts and Chat -->
					<div class="modal-body">
						<div class="row">
							<!-- Contacts List (Left Column) -->
							<div class="col-4" >
								<input type="hidden" id="currentChatId" value="">
								<div class="mb-3">
									<h6 style="color: white;">{% trans "Contacts" %}</h6>
									<ul class="list-group" id="contactList" style="height: 300px; overflow-y: auto;">
                    {% comment %} Contacts will be loaded here {% endcomment %}
									</ul>
								</div>
							</div>

							<!-- Chat Content (Right Column) -->
							<div class="col-8">
								<!-- Sticky header with contact name and avatar -->
								<div id="contactContainer" class="sticky-top bg-dark justify-content-between align-items-center p-2 rounded-3 " style="z-index: 1; top: 0; background-color: #333; display: none;">
									<div id="contactAvatarAndName" class="d-flex align-items-center">
										<a id="contactAvatarLink" href="#">
											<img id="contactAvatar" src="{% static 'images/game/cow400.png' %}" style="height: 3rem; width: 3rem; object-fit: cover; border-radius: 50%; border: 2px solid #fff;" class="me-2" alt="{% trans "avatar" %} 1">
										</a>
										<a id="contactDisplayNameLink" href="#">
											<p id="contactDisplayName" class="m-0" style="color: white;">{% trans "Select a contact" %}</p>
										</a>
									</div>

                  <div class="position-relative">
                    <button onclick="toggleGameInvitePopup()" class="btn btn-secondary">{% trans "Invite to play" %}</button>
                    <div id="gameInvitePopup" style="display: none;" class="position-absolute start-0" style="bottom: -20px">
                      <form method="post" id="chat-invite-play-0" action="{% url 'invite_to_play' 0 %}" class="d-flex flex-column justify-content-center relative" style="background-color: #333; border-radius: 10px;">
                        {% csrf_token %}

                        <div class="btn-group mx-auto" role="group" aria-label="{% trans 'Game selection' %}">

                          <input type="radio" class="btn-check" name="chosenGame" id="chat-pong-0" autocomplete="off" checked data-gametype="pong">
                          <label class="btn btn-outline-success d-flex flex-column justify-content-between align-items-center p-2" for="chat-pong-0" style="width: 80px; border-bottom-left-radius: 0;">
                            <img src="{% static 'images/cover-pong-8bits.jpg' %}" alt="Space Pong" title="Space Pong" class="img-fluid">
                          </label>
                        
                          <input type="radio" class="btn-check" name="chosenGame" id="chat-cows-0" autocomplete="off" data-gametype="cows">
                          <label class="btn btn-outline-success d-flex flex-column justify-content-between align-items-center p-2" for="chat-cows-0" style="width: 80px; border-bottom-right-radius: 0;">
                            <img src="{% static 'images/cover-cows.jpg' %}" alt="Space Cows" title="Space Cows" class="img-fluid">
                          </label>
                        
                        </div>
                        <button type="submit" class="btn btn-success" style="border-top-right-radius: 0; border-top-left-radius: 0;">{% trans "Invite to play" %}</button>

                      </form>
                    </div>
                  </div>
									<p id="date" class="small mb-0" style="color: white;">23 Jan 2:00 pm</p>
									<div id="blockSwitchContainer" style="display: none;">
										<div class="form-check form-switch">
											<input id="blockSwitch" data-user-id="" class="form-check-input" type="checkbox" {% if is_blocked %}checked{% endif %}>
											<label class="form-check-label text-white" for="blockSwitch">{% trans "Block" %}</label>
										</div>
									</div>
								</div>

								<!-- Scrollable chat content -->
								<div style="height: 300px; overflow-y: auto;">
									<!-- Conversation -->
									<div class="small p-2 me-3 mb-1 rounded-3" id="conversation"></div>
								</div>
							</div>
						</div>
					</div>

					<!-- Footer with message input -->
					<div class="modal-footer">
						<div id="chat-log" class="input-group mb-0">
							<input id="messageInput" type="text" class="form-control" placeholder="{% trans "Type message" %}" aria-label="{% trans "Recipient's username" %}" aria-describedby="button-addon2" />
							<button id="sendButton" class="btn btn-danger pt-2" type="button">{% trans "Send" %}</button>
						</div>
					</div>
				</div>
			</div>
		</div>
</section>

<script>
    var contactAvatarSrc = "{% static 'images/cow200.png' %}";
</script>

<script type="text/javascript">
	var noFriendsmsg = "{% trans 'You dont have any friend yet' %}";
	var selectFriendmsg = "{% trans 'Select a contact' %}";
</script>