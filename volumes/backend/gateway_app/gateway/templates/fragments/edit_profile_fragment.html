<h1>Edit <span class="text-danger">{{ user.username }}</span>'s Profile</h1>
<div class="row">

  <!-- Form 1: Avatar Upload -->
  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4 class="panel-title" style="margin-top: 30px">Avatar</h4>
        <div class="text-center">
          {% if user.avatar %}
          <img src="{{ user.avatar.url }}" alt="{{ user.username }}" style="height: 10rem; width: 10rem; object-fit: cover; border-radius: 50%; border: 2px solid #fff;">
          {% else %}
          <img src="https://api.dicebear.com/9.x/notionists/svg?seed=Jack" alt="Default avatar" style="height: 10rem; width: 10rem; object-fit: cover; border-radius: 50%; border: 2px solid #fff;">
          {% endif %}
        </div>
        <form action="{% url 'edit_profile_avatar' %}" id="file-upload" method="post" enctype="multipart/form-data" style="margin-top: 20px;">
          {% csrf_token %}
          <div class="mb-3">
            <label for="{{ form.avatar.id_for_label }}" class="form-group">{{ form.avatar.label }}</label>
            <input type="file" id="{{ form.avatar.id_for_label }}" class="form-control" name="{{ form.avatar.name }}" >
            <div class="text-danger fs-6">{{ form.avatar.errors }}</div>
          </div>
          <button type="submit" class="btn btn-success">Upload Avatar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Form 2: General Info -->
  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4 class="panel-title" style="margin-top: 30px">User Info {{profile_data.city}}</h4>
        <form method="post" action="{% url 'edit_profile_general' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="{{ form.display_name.id_for_label }}" class="form-group">{{ form.display_name.label }}</label>
            <input type="text" id="{{ form.display_name.id_for_label }}" class="form-control" name="{{ form.display_name.name }}" value="{{ profile_data.display_name }}" >
            <div class="text-danger fs-6">{{ form.display_name.errors }}</div>
          </div>
          <div class="mb-3">
            <label for="{{ form.country.id_for_label }}" class="form-group">{{ form.country.label }}</label>
            <input type="text" id="{{ form.country.id_for_label }}" class="form-control" name="{{ form.country.name }}" value="{{ profile_data.country }}" >
            <div class="text-danger fs-6">{{ form.country.errors }}</div>
          </div>
          <div class="mb-3">
            <label for="{{ form.city.id_for_label }}" class="form-group">{{ form.city.label }}</label>
            <input type="text" id="{{ form.city.id_for_label }}" class="form-control" name="{{ form.city.name }}" value="{{ profile_data.city }}" >
            <div class="text-danger fs-6">{{ form.city.errors }}</div>
          </div>
          <div class="mb-3">
            <label for="preferred_language" class="form-group">Preferred Language</label>
            <div id="preferred_language" role="group" aria-label="Basic radio toggle button group">
              <input type="radio" class="btn-check" name="preferred_language" id="btnradio1" value="en" autocomplete="off" {% if profile_data.preferred_language == 'en' %}checked{% endif %}>
              <label class="btn btn-outline-primary" for="btnradio1">English</label>
              
              <input type="radio" class="btn-check" name="preferred_language" id="btnradio2" value="es" autocomplete="off" {% if profile_data.preferred_language == 'es' %}checked{% endif %}>
              <label class="btn btn-outline-primary" for="btnradio2">Spanish</label>
              
              <input type="radio" class="btn-check" name="preferred_language" id="btnradio3" value="fr" autocomplete="off" {% if profile_data.preferred_language == 'fr' %}checked{% endif %}>
              <label class="btn btn-outline-primary" for="btnradio3">French</label>
            </div>
            <div class="text-danger fs-6">{{ form.preferred_language.errors }}</div>
          </div>
          <button type="submit" class="btn btn-success">Submit</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Form 3: Security Info -->
  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-body">
        <h4 class="panel-title" style="margin-top: 30px">Security</h4>
        <form method="post" action="{% url 'edit_profile_security' %}" onsubmit="return validatePasswords()">
          {% csrf_token %}
          <div class="mb-3">
            <label for="{{ form.username.id_for_label }}" class="form-group">{{ form.username.label }}</label>
            <input type="text" id="{{ form.username.id_for_label }}" class="form-control" name="{{ form.username.name }}" value="{{ user.username }}" >
            <div class="text-danger fs-6">{{ form.username.errors }}</div>
          </div>
          <div class="mb-3">
            <label for="{{ form.new_password.id_for_label }}" class="form-group">{{ form.new_password.label }}</label>
            {{ form.new_password }}
            <div class="text-danger fs-6">{{ form.new_password.errors }}</div>
          </div>
          <div class="mb-3">
            <label for="{{ form.confirm_password.id_for_label }}" class="form-group">{{ form.confirm_password.label }}</label>
            {{ form.confirm_password }}
            <div class="text-danger fs-6">{{ form.confirm_password.errors }}</div>
          </div>
          <button type="submit" class="btn btn-success">Change Password</button>
        </form>
      </div>
    </div>
  </div>

</div>

<script>
  function validatePasswords() {
    var newPassword = document.getElementById('{{ form.new_password.id_for_label }}').value;
    var confirmPassword = document.getElementById('{{ form.confirm_password.id_for_label }}').value;

    // Define the error message
    var errorMessage = "{{ 'Passwords do not match!'|escapejs }}";

    if (newPassword !== confirmPassword) {
      alert(errorMessage);
      return false; // Prevent form submission
    }
    return true; // Allow form submission
  }
</script>
